# Logger 接口重构说明

## 概述

为了提高 zllog 的灵活性和可扩展性，我们将公共日志方法重构为接口形式，允许用户实现自定义的 Logger。

## 主要变更

### 1. 新增 Logger 接口

定义了 `Logger` 接口，包含所有日志方法：

```go
type Logger interface {
    Debug(ctx context.Context, module, message string, fields ...Field)
    Info(ctx context.Context, module, message string, fields ...Field)
    Warn(ctx context.Context, module, message string, fields ...Field)
    Error(ctx context.Context, module, message string, err error, fields ...Field)
    ErrorWithCode(ctx context.Context, module, message, errorCode string, err error, fields ...Field)
    Fatal(ctx context.Context, module, message string, err error, fields ...Field)
    InfoWithRequest(ctx context.Context, module, message, requestID string, costMs int64, fields ...Field)
    ErrorWithRequest(ctx context.Context, module, message, requestID string, err error, costMs int64, fields ...Field)
}
```

### 2. 默认实现

提供了基于 Zerolog 的默认实现 `ZerologLogger`，保持向后兼容。

### 3. 自定义实现支持

新增 `SetLogger()` 和 `GetLogger()` 函数，支持运行时替换日志实现。

```go
// 设置自定义 Logger
zllog.SetLogger(&MyCustomLogger{})

// 获取当前 Logger 实现
logger := zllog.GetLogger()
```

## 使用场景

### 场景 1：使用其他日志库

```go
type LogrusLogger struct {
    logger *logrus.Logger
}

func (l *LogrusLogger) Info(ctx context.Context, module, message string, fields ...zllog.Field) {
    logrusFields := logrus.Fields{}
    for _, f := range fields {
        logrusFields[f.Key] = f.Value
    }
    l.logger.WithFields(logrusFields).Info(message)
}

// 实现其他方法...

zllog.SetLogger(&LogrusLogger{logger: logrus.New()})
```

### 场景 2：发送日志到远程服务

参见 `examples/remote_logger/main.go`，展示了如何：
- 批量发送日志到 HTTP 服务
- 异步发送避免阻塞业务
- 失败重试机制
- 优雅停止

### 场景 3：自定义日志格式

```go
type JSONLogger struct{}

func (l *JSONLogger) Info(ctx context.Context, module, message string, fields ...zllog.Field) {
    logData := map[string]interface{}{
        "module":  module,
        "message": message,
        "time":    time.Now().Unix(),
    }
    for _, f := range fields {
        logData[f.Key] = f.Value
    }
    jsonData, _ := json.Marshal(logData)
    fmt.Println(string(jsonData))
}

// 实现其他方法...
```

## 文件结构

```
zllog/
├── log.go                           # 核心日志实现（新增 Logger 接口）
├── examples/
│   ├── custom_logger/              # 简单的自定义 Logger 示例
│   │   └── main.go
│   └── remote_logger/              # 远程日志发送示例
│       └── main.go
└── docs/
    └── logger_interface.md         # 本文档
```

## 向后兼容性

✅ **完全向后兼容**：
- 现有的日志调用代码无需修改
- 默认行为保持不变（使用 Zerolog 实现）
- 只是想自定义的用户才需要实现接口

## 运行示例

### 示例 1：自定义 Logger

```bash
cd examples/custom_logger
go run main.go
```

### 示例 2：远程 Logger

```bash
cd examples/remote_logger
go run main.go
```

## 注意事项

1. **线程安全**：自定义 Logger 实现需要保证线程安全
2. **性能考虑**：避免在日志方法中执行耗时操作
3. **错误处理**：建议异步发送日志，避免阻塞业务
4. **优雅停止**：如果使用后台 goroutine，记得实现优雅停止机制

## 未来计划

- 提供更多官方实现的适配器（如 Loki、Elasticsearch）
- 添加日志采样、过滤等高级功能
- 支持结构化日志的自动转换
