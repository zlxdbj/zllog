# zllog ç›®å½•ç»“æ„åˆ†æï¼šlogger å­ç›®å½•çš„ä¼˜ç¼ºç‚¹

## é—®é¢˜æè¿°
æ˜¯å¦åº”è¯¥å°† `zerolog_logger.go` æ”¾åˆ° `logger/` å­ç›®å½•ä¸‹ï¼Ÿ

## ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆ Aï¼šå½“å‰ç»“æ„ï¼ˆæ¨èï¼‰âœ…
```
zllog/
â”œâ”€â”€ log.go                  # åŒ…å: zllog
â”œâ”€â”€ zerolog_logger.go       # åŒ…å: zllog
â”œâ”€â”€ config.go               # åŒ…å: zllog
â””â”€â”€ logger_test.go          # åŒ…å: zllog
```

**ä½¿ç”¨æ–¹å¼**ï¼š
```go
import "github.com/zlxdbj/zllog"

// ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€å…³å¿ƒæ–‡ä»¶ç»„ç»‡
logger := zllog.NewZerologLogger(&log)
zllog.SetLogger(logger)
```

### æ–¹æ¡ˆ Bï¼šå­ç›®å½•ç»“æ„ âš ï¸
```
zllog/
â”œâ”€â”€ log.go                      # åŒ…å: zllog
â”œâ”€â”€ config.go                   # åŒ…å: zllog
â””â”€â”€ logger/                     # å­åŒ…: logger
    â”œâ”€â”€ zerolog_logger.go       # åŒ…å: logger
    â””â”€â”€ zap_logger.go          # åŒ…å: logger
```

**ä½¿ç”¨æ–¹å¼**ï¼š
```go
import (
    "github.com/zlxdbj/zllog"
    "github.com/zlxdbj/zllog/logger"  // éœ€è¦é¢å¤–å¯¼å…¥
)

// ä½¿ç”¨æ—¶éœ€è¦æŒ‡å®šå­åŒ…
logger := logger.NewZerologLogger(&log)
zllog.SetLogger(logger)
```

## âš ï¸ Go è¯­è¨€è§’åº¦çš„ç¼ºç‚¹

### 1. **åŒ…åå†²çªå’Œæ··æ·†**

å¦‚æœ `logger/` ç›®å½•çš„åŒ…åæ˜¯ `logger`ï¼š

```go
package logger  // âŒ ä¸å¥½ï¼šåŒ…åå’Œç›®å½•åé‡å¤

type ZerologLogger struct {...}
```

**é—®é¢˜**ï¼š
- `logger.Logger` çœ‹èµ·æ¥å¾ˆå¥‡æ€ªï¼ˆåŒ…åå’Œç±»å‹åç›¸ä¼¼ï¼‰
- å®¹æ˜“å’Œå…¶ä»–åº“çš„ `logger` åŒ…æ··æ·†
- IDE è‡ªåŠ¨è¡¥å…¨æ—¶ä¼šå‡ºç° `logger.logger.`

**æ›´å¥½çš„åšæ³•**ï¼š
```go
package zerolog  // âœ… ä½¿ç”¨å…·ä½“å®ç°åç§°

type Logger struct {...}  // zerolog.Logger
```

### 2. **ç±»å‹å¯è§æ€§é—®é¢˜**

#### åœºæ™¯ï¼šåœ¨ log.go ä¸­å¼•ç”¨ ZerologLogger

**æ–¹æ¡ˆ Aï¼ˆå½“å‰ï¼‰** - åŒåŒ…ï¼š
```go
// log.go
package zllog

func getLogger() Logger {
    if globalLoggerImpl == nil {
        // âœ… åŒåŒ…å†…ï¼Œå¯ä»¥ç›´æ¥å¼•ç”¨æœªå¯¼å‡ºçš„ç±»å‹
        return NewZerologLogger(&globalLogger)
    }
    return globalLoggerImpl
}

// zerolog_logger.go
package zllog

// NewZerologLogger åœ¨åŒåŒ…å†…å¯ç›´æ¥è°ƒç”¨
func NewZerologLogger(logger *zerolog.Logger) *ZerologLogger {
    return &ZerologLogger{logger: logger}
}
```

**æ–¹æ¡ˆ Bï¼ˆå­ç›®å½•ï¼‰** - è·¨åŒ…ï¼š
```go
// log.go
package zllog

import "github.com/zlxdbj/zllog/logger"

func getLogger() Logger {
    if globalLoggerImpl == nil {
        // âš ï¸ å¿…é¡»é€šè¿‡å­åŒ…è®¿é—®
        return logger.NewZerologLogger(&globalLogger)
    }
    return globalLoggerImpl
}

// logger/zerolog_logger.go
package logger

// NewZerologLogger å¿…é¡»å¯¼å‡ºæ‰èƒ½è¢«å¤–éƒ¨åŒ…ä½¿ç”¨
func NewZerologLogger(logger *zerolog.Logger) *ZerologLogger {
    return &ZerologLogger{logger: logger}
}

// ZerologLogger å¿…é¡»å¯¼å‡ºï¼ˆå¤§å†™å¼€å¤´ï¼‰
type ZerologLogger struct {
    logger *zerolog.Logger
}
```

**é—®é¢˜**ï¼š
- æ‰€æœ‰ç±»å‹å’Œæ–¹æ³•å¿…é¡»å¯¼å‡ºï¼ˆå¤§å†™å¼€å¤´ï¼‰
- å¢åŠ äº†å…¬å¼€ APIï¼Œä¸åˆ©äºå°è£…
- ç”¨æˆ·å¯èƒ½ä¼šè¯¯ç”¨å†…éƒ¨å®ç°

### 3. **å¾ªç¯ä¾èµ–é£é™©**

#### å¯èƒ½çš„å¾ªç¯ä¾èµ–åœºæ™¯

```go
// log.go
package zllog

import "github.com/zlxdbj/zllog/logger"

type Field struct {...}  // å®šä¹‰åœ¨ä¸»åŒ…

// logger/zerolog_logger.go
package logger

import "github.com/zlxdbj/zllog"  // âŒ å¯èƒ½å¾ªç¯ä¾èµ–

func (l *ZerologLogger) Info(ctx context.Context, module, message string, fields ...zllog.Field) {
    // éœ€è¦ import zllog æ¥ä½¿ç”¨ Field ç±»å‹
}
```

**é—®é¢˜**ï¼š
- `zllog` ä¾èµ– `logger`ï¼ˆåˆ›å»º Loggerï¼‰
- `logger` ä¾èµ– `zllog`ï¼ˆä½¿ç”¨ Field ç±»å‹ï¼‰
- **å¾ªç¯ä¾èµ–ï¼** ç¼–è¯‘å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼ˆä½†éƒ½ä¸å®Œç¾ï¼‰ï¼š

1. **å°† Field ç§»åˆ°ç‹¬ç«‹çš„ package**ï¼š
```
zllog/
â”œâ”€â”€ types/       # æ–°å¢ç±»å‹åŒ…
â”‚   â””â”€â”€ field.go
â”œâ”€â”€ log.go
â””â”€â”€ logger/
    â””â”€â”€ zerolog_logger.go
```
â†’ è¿‡åº¦è®¾è®¡ï¼Œä¸ºäº†ä¸€ä¸ªå­—æ®µç±»å‹å¢åŠ åŒ…

2. **åœ¨ logger åŒ…ä¸­é‡æ–°å®šä¹‰ Field**ï¼š
```go
// logger/field.go
package logger

type Field struct {
    Key   string
    Value interface{}
}
```
â†’ ä»£ç é‡å¤ï¼Œç±»å‹ä¸ä¸€è‡´

3. **ä½¿ç”¨æ¥å£**ï¼š
```go
// log.go
type Field interface {
    Key() string
    Value() interface{}
}
```
â†’ å¢åŠ å¤æ‚åº¦ï¼Œæ€§èƒ½ä¸‹é™

### 4. **Go æƒ¯ç”¨æ³•ä¸ç¬¦åˆ**

#### Go å®˜æ–¹æ¨èçš„åŒ…ç»“æ„

```
// âœ… æ¨èï¼šå°è€Œæ‰å¹³çš„åŒ…ç»“æ„
package main

import "github.com/example/mylib"

// mylib/
// â”œâ”€â”€ types.go
// â”œâ”€â”€ impl.go
// â””â”€â”€ utils.go
```

```
// âŒ ä¸æ¨èï¼šè¿‡åº¦åµŒå¥—çš„å­åŒ…
package main

import "github.com/example/mylib/internal/impl"

// mylib/
// â”œâ”€â”€ types.go
// â””â”€â”€ internal/
//     â””â”€â”€ impl/
//         â””â”€â”€ impl.go
```

**Go è¯­è¨€å“²å­¦**ï¼š
- "A little copying is better than a little dependency" - Rob Pike
- å€¾å‘äºæ‰å¹³çš„åŒ…ç»“æ„
- é¿å…ä¸å¿…è¦çš„åŒ…åµŒå¥—

### 5. **å¯¼å…¥è·¯å¾„å˜é•¿**

**å¯¹æ¯”**ï¼š

```go
// âœ… æ–¹æ¡ˆ Aï¼šç®€æ´
import "github.com/zlxdbj/zllog"

// âŒ æ–¹æ¡ˆ Bï¼šå†—é•¿
import (
    "github.com/zlxdbj/zllog"
    "github.com/zlxdbj/zllog/logger"
    "github.com/zlxdbj/zllog/logger/zap"      // å¦‚æœæœ‰å¤šä¸ªå®ç°
    "github.com/zlxdbj/zllog/logger/logrus"
)
```

### 6. **ç±»å‹è½¬æ¢é—®é¢˜**

```go
// æ–¹æ¡ˆ B çš„æ½œåœ¨é—®é¢˜
var impl zllog.Logger = logger.NewZerologLogger(...)

// âŒ æ— æ³•è½¬å›å…·ä½“ç±»å‹ï¼ˆåœ¨ä¸åŒåŒ…ä¸­ï¼‰
if zlog, ok := impl.(*logger.ZerologLogger); ok {
    // åœ¨ zllog åŒ…ä¸­æ— æ³•è®¿é—® logger.ZerologLogger çš„å†…éƒ¨å­—æ®µ
}
```

## âœ… æ–¹æ¡ˆ A çš„ä¼˜åŠ¿

### 1. **ç®€æ´æ€§**
```go
import "github.com/zlxdbj/zllog"

// ä¸€ä¸ªåŒ…æå®š
zllog.InitLogger()
zllog.Info(ctx, "module", "message")
```

### 2. **å°è£…æ€§**
```go
// å†…éƒ¨å®ç°å¯ä»¥ä¸å¯¼å‡º
type zerologLogger struct {  // å°å†™ï¼Œä¸å¯¼å‡º
    logger *zerolog.Logger
}

// åªå¯¼å‡ºæ¥å£
type Logger interface { ... }
```

### 3. **æ€§èƒ½**
```go
// åŒåŒ…å†…è°ƒç”¨ï¼Œæ— æ¥å£å¼€é”€
func getLogger() Logger {
    if globalLoggerImpl == nil {
        return newZerologLogger(&globalLogger)  // å†…éƒ¨å‡½æ•°
    }
    return globalLoggerImpl
}
```

### 4. **çµæ´»æ€§**
```go
// æœªæ¥å¯ä»¥è½»æ¾æ·»åŠ å…¶ä»–å®ç°
zllog/
â”œâ”€â”€ log.go
â”œâ”€â”€ zerolog_logger.go
â”œâ”€â”€ zap_logger.go          # ç›´æ¥æ·»åŠ åˆ°ä¸»åŒ…
â”œâ”€â”€ logrus_logger.go       # ç›´æ¥æ·»åŠ åˆ°ä¸»åŒ…
â””â”€â”€ loki_logger.go         # ç›´æ¥æ·»åŠ åˆ°ä¸»åŒ…
```

### 5. **æµ‹è¯•å‹å¥½**
```go
// æµ‹è¯•åœ¨åŒä¸€åŒ…å†…ï¼Œå¯ä»¥è®¿é—®æœªå¯¼å‡ºçš„ç±»å‹
package zllog_test

func TestZerologLogger(t *testing.T) {
    logger := newZerologLogger(...)  // å¯ä»¥è®¿é—®æœªå¯¼å‡ºçš„æ„é€ å‡½æ•°
    // æµ‹è¯•å†…éƒ¨ç»†èŠ‚
}
```

## ğŸ¯ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨å­åŒ…ï¼Ÿ

### é€‚åˆä½¿ç”¨å­åŒ…çš„åœºæ™¯

#### 1. **adapter/ é€‚é…å™¨åŒ…** âœ…
```
zllog/
â””â”€â”€ adapter/
    â””â”€â”€ gormadapter/
        â””â”€â”€ gorm.go
```

**åŸå› **ï¼š
- æ˜¯å¯é€‰çš„æ‰©å±•åŠŸèƒ½
- æœ‰ç‹¬ç«‹çš„å¯¼å…¥è·¯å¾„ï¼ˆ`github.com/zlxdbj/zllog/adapter/gormadapter`ï¼‰
- ä¸ä¼šè¢«ä¸»åŒ…ç›´æ¥ importï¼ˆç”¨æˆ·æŒ‰éœ€å¯¼å…¥ï¼‰

#### 2. **internal/ å†…éƒ¨åŒ…** âœ…
```
zllog/
â”œâ”€â”€ log.go
â””â”€â”€ internal/
    â””â”€â”€ config_loader.go
```

**åŸå› **ï¼š
- éšè—å†…éƒ¨å®ç°
- Go å·¥å…·é“¾é˜»æ­¢å¤–éƒ¨åŒ… import internal

#### 3. **examples/ ç¤ºä¾‹åŒ…** âœ…
```
zllog/
â””â”€â”€ examples/
    â”œâ”€â”€ custom_logger/
    â””â”€â”€ remote_logger/
```

**åŸå› **ï¼š
- ç‹¬ç«‹çš„å¯æ‰§è¡Œç¨‹åº
- ä¸å½±å“ä¸»åŒ…çš„ä½¿ç”¨

### ä¸é€‚åˆä½¿ç”¨å­åŒ…çš„åœºæ™¯

#### âŒ æ ¸å¿ƒå®ç°çš„åˆ†ç¦»
```
zllog/
â””â”€â”€ logger/
    â””â”€â”€ zerolog_logger.go  # ä¸æ¨è
```

**åŸå› **ï¼š
- æ ¸å¿ƒåŠŸèƒ½åº”è¯¥åœ¨ä¸»åŒ…
- å¢åŠ ä¸å¿…è¦çš„å¤æ‚åº¦
- è¿å Go çš„æƒ¯ç”¨æ³•

## ğŸ“ˆ å®é™…æ¡ˆä¾‹

### Go æ ‡å‡†åº“çš„ç»“æ„

```go
// net/http - å¤§å‹åŒ…ï¼Œä½†ç»“æ„æ‰å¹³
net/
â””â”€â”€ http/
    â”œâ”€â”€ client.go          # 7279 è¡Œ
    â”œâ”€â”€ server.go          # 5498 è¡Œ
    â”œâ”€â”€ cookie.go          # 1208 è¡Œ
    â”œâ”€â”€ request.go         # 1827 è¡Œ
    â”œâ”€â”€ response.go        # 1191 è¡Œ
    â”œâ”€â”€ transport.go       # 1920 è¡Œ
    â””â”€â”€ ...
    // æ²¡æœ‰å­åŒ…ï¼æ‰€æœ‰æ–‡ä»¶éƒ½åœ¨åŒä¸€ç›®å½•
```

### æµè¡Œçš„æ—¥å¿—åº“

```go
// zap - Uber çš„æ—¥å¿—åº“
zap/
â”œâ”€â”€ zap.go                # ä¸»æ–‡ä»¶
â”œâ”€â”€ logger.go             # Logger æ¥å£
â”œâ”€â”€ encoder.go            # ç¼–ç å™¨
â”œâ”€â”€ field.go              # å­—æ®µ
â””â”€â”€ ...
// æ²¡æœ‰å­åŒ…åˆ†ç¦»å®ç°

// zerolog - æˆ‘ä»¬åŸºäºçš„åº“
zerolog/
â”œâ”€â”€ event.go              # 1332 è¡Œ
â”œâ”€â”€ log.go                # 1141 è¡Œ
â”œâ”€â”€ console.go            # 589 è¡Œ
â””â”€â”€ ...
// æ²¡æœ‰å­åŒ…åˆ†ç¦»å®ç°
```

## ğŸ¯ æœ€ç»ˆå»ºè®®

### âœ… æ¨èï¼šå½“å‰ç»“æ„

```
zllog/
â”œâ”€â”€ log.go                  # æ ¸å¿ƒæ¥å£å’Œé…ç½®
â”œâ”€â”€ zerolog_logger.go       # Zerolog å®ç°
â”œâ”€â”€ zap_logger.go          # æœªæ¥ï¼šZap å®ç°
â”œâ”€â”€ logrus_logger.go       # æœªæ¥ï¼šLogrus å®ç°
â”œâ”€â”€ config.go
â””â”€â”€ logger_test.go
```

**ç†ç”±**ï¼š
1. ç¬¦åˆ Go è¯­è¨€æƒ¯ç”¨æ³•
2. ç®€æ´æ˜“ç”¨
3. æ— å¾ªç¯ä¾èµ–é£é™©
4. æ€§èƒ½æ›´å¥½
5. æµ‹è¯•æ›´å®¹æ˜“
6. ç»´æŠ¤æˆæœ¬ä½

### âŒ ä¸æ¨èï¼šlogger å­åŒ…

```
zllog/
â”œâ”€â”€ log.go
â””â”€â”€ logger/
    â”œâ”€â”€ zerolog_logger.go
    â”œâ”€â”€ zap_logger.go
    â””â”€â”€ logrus_logger.go
```

**é—®é¢˜**ï¼š
1. è¿å Go æƒ¯ç”¨æ³•
2. å¢åŠ å¤æ‚åº¦
3. å¾ªç¯ä¾èµ–é£é™©
4. ç±»å‹å¿…é¡»å¯¼å‡º
5. å¯¼å…¥è·¯å¾„å˜é•¿

## ğŸ”„ å¦‚æœçœŸçš„éœ€è¦ç»„ç»‡å¤šä¸ªå®ç°

### æ–¹æ¡ˆ 1ï¼šæ³¨é‡Šåˆ†ç»„ï¼ˆæ¨èï¼‰

```go
// log.go

// ============================================================================
// Logger æ¥å£ - æ”¯æŒè‡ªå®šä¹‰æ—¥å¿—å®ç°
// ============================================================================

type Logger interface { ... }

func SetLogger(logger Logger) { ... }

// ============================================================================
// Zerolog å®ç°
// ============================================================================

type ZerologLogger struct { ... }
func NewZerologLogger(...) { ... }

// ============================================================================
// Zap å®ç°ï¼ˆæœªæ¥ï¼‰
// ============================================================================

// type ZapLogger struct { ... }
// func NewZapLogger(...) { ... }
```

### æ–¹æ¡ˆ 2ï¼šä½¿ç”¨ Go çš„ build tags

```go
// zerolog_logger.go
// +build !use_zap

package zllog

type defaultLogger = ZerologLogger

// zap_logger.go
// +build use_zap

package zllog

type defaultLogger = ZapLogger
```

### æ–¹æ¡ˆ 3ï¼šadapter æ¨¡å¼ï¼ˆå¯é€‰å®ç°ï¼‰

```
zllog/
â”œâ”€â”€ log.go
â”œâ”€â”€ zerolog_logger.go       # é»˜è®¤å®ç°
â””â”€â”€ adapters/               # å¯é€‰çš„ç¬¬ä¸‰æ–¹é€‚é…å™¨
    â”œâ”€â”€ zap/
    â”‚   â””â”€â”€ zap_logger.go
    â””â”€â”€ logrus/
        â””â”€â”€ logrus_logger.go
```

**ä½¿ç”¨æ–¹å¼**ï¼š
```go
// é»˜è®¤ï¼šä½¿ç”¨å†…ç½®çš„ Zerolog
zllog.InitLogger()

// å¯é€‰ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹é€‚é…å™¨
import _ "github.com/zlxdbj/zllog/adapters/zap"
// è‡ªåŠ¨æ³¨å†Œ
```

## ğŸ“š å‚è€ƒèµ„æ–™

- [Go Code Review Comments - Package Names](https://github.com/golang/go/wiki/CodeReviewComments#package-names)
- [Effective Go - Package names](https://golang.org/doc/effective_go.html#package-names)
- [Go Blog - Package names](https://go.dev/blog/package-names)

## æ€»ç»“

å¯¹äº zllog è¿™ç§è§„æ¨¡çš„æ—¥å¿—åº“ï¼š
- âœ… **æ¨è**ï¼šä¿æŒæ‰å¹³ç»“æ„ï¼Œæ‰€æœ‰æ ¸å¿ƒå®ç°åœ¨ä¸»åŒ…
- âŒ **ä¸æ¨è**ï¼šåˆ›å»º logger å­åŒ…æ¥å­˜æ”¾å®ç°

åªæœ‰å½“å®ç°æ˜¯**å¯é€‰çš„é€‚é…å™¨**ï¼ˆå¦‚ GORM adapterï¼‰æ—¶ï¼Œæ‰ä½¿ç”¨å­åŒ…ç»“æ„ã€‚
